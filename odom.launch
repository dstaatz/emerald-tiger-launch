<!-- Copyright (C) 2020 Dylan Staatz - All Rights Reserved. -->

<launch>

    <arg name="imu_serial_port" default="/dev/ttyUSB0"/>
    <arg name="lidar_serial_port" default="/dev/rplidar"/>

    <!-- Static frame (base -> imu) -->
    <!-- For my robot, the imu scanner is rotated 90 degrees counterclockwise from this frame: https://raw.githubusercontent.com/robopeak/rplidar_ros/master/rplidar_A1.png -->
    <node pkg="tf" type="static_transform_publisher" name="base_imu_broadcaster" args="0 0 0 0 -1.570796 0 base imu 100"/>

    <!-- Reading imu data from bno055 through serial -->
    <include file="$(find ros_imu_bno055)/launch/imu.launch">
        <arg name="serial_port"         value="$(arg imu_serial_port)"/>
        <arg name="frame_id"            value="imu"/>
        <arg name="operation_mode"      value="IMU"/>
        <arg name="oscillator"          value="INTERNAL"/>
        <arg name="reset_orientation"   value="true"/>
        <arg name="frequency"           value="50"/>
        <arg name="use_magnetometer"    value="false"/>
        <arg name="use_temperature"     value="false"/>
    </include>

    <!-- Translates imu data to (odom -> base) frame -->
    <node pkg="robot_pose_ekf" type="robot_pose_ekf" name="robot_pose_ekf">
        <param name="output_frame"          value="odom"/>
        <param name="base_footprint_frame"  value="base"/>
        <param name="freq"                  value="30.0"/>
        <param name="sensor_timeout"        value="1.0"/>
        <param name="odom_used"             value="false"/>
        <param name="imu_used"              value="true"/>
        <param name="vo_used"               value="false"/>

        <!-- <remap from="odom" to="pr2_base_odometry/odom"/> -->
        <remap from="imu_data" to="imu/data"/>
    </node>

</launch>
